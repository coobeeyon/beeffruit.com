---
const title = Astro.props?.title ?? 'Trending Weirdness';
---
<section class="py-8">
  <h2 class="text-2xl md:text-3xl font-bold mb-4">{title}</h2>
  <div id="bf-feed" class="columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-4 space-y-4"></div>
  <button id="bf-more" class="mt-6 w-full rounded-lg bg-brand-pink/20 text-brand-pink hover:bg-brand-pink/30 py-3 font-semibold">More oddities</button>
</section>

<script>
  const FEED_URL = '/data/items.json';
  let all = [];
  let idx = 0;
  const batch = 12;

  // Content chaos generators
  const prefixes = [
    'ğŸš¨ BREAKING:', 'âš ï¸ WARNING:', 'ğŸ’¥ EXCLUSIVE:', 'ğŸ”¥ HOT TAKE:', 
    'ğŸ‘ï¸ THEY DON\'T WANT YOU TO KNOW:', 'ğŸ¯ FACT:', 'ğŸŒŸ LEAKED:', 
    'ğŸ’€ CURSED:', 'ğŸ”® PREDICTION:', 'ğŸª CIRCUS ALERT:', 'ğŸ§  BIG BRAIN:',
    'âš¡ URGENT:', 'ğŸ­ PLOT TWIST:', 'ğŸŒˆ MIRACLE:', 'ğŸ¦¾ GIGACHAD:'
  ];

  const suffixes = [
    '(GONE WRONG)', '(EMOTIONAL)', '(3AM CHALLENGE)', '(NOT CLICKBAIT)',
    '(COPS CALLED)', '(SCIENTIFICALLY PROVEN)', '(DOCTORS HATE THIS)',
    '(YOU WON\'T BELIEVE #7)', '(LIFE-CHANGING)', '(INSTANT REGRET)',
    '(99% FAIL)', '(IMPOSSIBLE)', '(GLITCH IN THE MATRIX)', '(REAL)',
    '??? EXPLAINED', '... AND THAT\'S A GOOD THING', '[UPDATED 2025]'
  ];

  const ratings = [
    'â­â­â­â­â­ 5/5 BEEF', 'ğŸ– 10/10 MEAT SCORE', 'ğŸ¥© PRIME CUT',
    'ğŸ‰ FRUIT LEVEL: MAXIMUM', 'ğŸ’¯ CERTIFIED', 'âœ… FACT-CHECKED BY NOBODY',
    'ğŸ† AWARD-WINNING NONSENSE', 'ğŸ“Š 87% OF STATISTICS ARE MADE UP',
    'ğŸ¯ ACCURACY: QUESTIONABLE', 'ğŸ”¬ PEER REVIEWED BY MY CAT'
  ];

  const warnings = [
    'âš ï¸ Side effects may include enlightenment',
    'âš ï¸ Not suitable for robots',
    'âš ï¸ Contains trace amounts of truth',
    'âš ï¸ May cause spontaneous beef cravings',
    'âš ï¸ Warranty void if actually read',
    'âš ï¸ FDA has not evaluated these claims',
    'âš ï¸ Results not typical',
    'âš ï¸ May contain nuts (definitely contains fruits)'
  ];

  const testimonials = [
    '"Changed my life" - Anonymous Beef',
    '"I can\'t stop reading" - Local Fruit',
    '"This cured my boredom" - Internet Person',
    '"10/10 would click again" - Your Mom',
    '"Finally, the truth!" - Conspiracy Theorist',
    '"I showed this to my therapist" - Reddit User',
    '"Why did I read this?" - You, probably'
  ];

  const prices = [
    'WAS $999 NOW FREE', 'LIMITED TIME: $0.00', 'SPECIAL OFFER: YOUR SOUL',
    'PRICE: 3 EASY PAYMENTS OF CHAOS', 'VALUE: PRICELESS', 'COST: 5 MINUTES YOU\'LL NEVER GET BACK'
  ];

  function getRandomElement(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function generateChaosContent(item) {
    const templates = [
      // Standard with prefix/suffix
      () => ({
        title: `${Math.random() > 0.5 ? getRandomElement(prefixes) + ' ' : ''}${item.title}${Math.random() > 0.5 ? ' ' + getRandomElement(suffixes) : ''}`,
        extra: Math.random() > 0.7 ? getRandomElement(ratings) : ''
      }),
      // Review format
      () => ({
        title: item.title,
        extra: `<div class="mt-2 text-xs opacity-80">${getRandomElement(testimonials)}</div>`
      }),
      // Warning format
      () => ({
        title: item.title.toUpperCase(),
        extra: `<div class="mt-2 text-xs text-yellow-400">${getRandomElement(warnings)}</div>`
      }),
      // Price drop format
      () => ({
        title: item.title,
        extra: `<div class="mt-2 text-sm font-bold text-brand-green">${getRandomElement(prices)}</div>`
      }),
      // Question format
      () => ({
        title: `Is ${item.title}? The Answer Will SHOCK You`,
        extra: ''
      }),
      // Versus format
      () => ({
        title: `${item.title} vs. ${getRandomElement(['REALITY', 'YOUR EXPECTATIONS', 'COMMON SENSE', 'THE ESTABLISHMENT', 'BIG FRUIT'])}`,
        extra: ''
      }),
      // List format
      () => ({
        title: `${Math.floor(Math.random() * 50 + 5)} Reasons Why ${item.title}`,
        extra: `<div class="text-xs mt-1">#${Math.floor(Math.random() * 20 + 1)} will make you cry</div>`
      }),
      // Timeline format
      () => ({
        title: item.title,
        extra: `<div class="text-xs mt-2 opacity-60">Posted ${Math.floor(Math.random() * 59 + 1)} ${getRandomElement(['seconds', 'minutes', 'hours', 'days', 'years', 'centuries'])} ago</div>`
      }),
      // BREAKING NEWS format
      () => ({
        title: item.title,
        extra: `<div class="text-xs mt-2 text-red-500 font-bold animate-pulse">DEVELOPING STORY</div>`
      }),
      // Recipe format
      () => ({
        title: `RECIPE: ${item.title}`,
        extra: `<div class="text-xs mt-1">Prep: ${Math.random() * 100}min | Serves: ${Math.random() > 0.5 ? 'Nobody' : Math.floor(Math.random() * 1000)}</div>`
      })
    ];

    return templates[Math.floor(Math.random() * templates.length)]();
  }

  // Card type generators for content variety with weighted distribution
  function generateCardType() {
    const rand = Math.random();
    
    // Weighted distribution to reduce review frequency
    if (rand < 0.35) return { type: 'standard', height: 'auto' };        // 35% standard
    else if (rand < 0.50) return { type: 'tall', height: 'min-h-[300px]' }; // 15% tall
    else if (rand < 0.62) return { type: 'quote', height: 'auto' };      // 12% quotes
    else if (rand < 0.74) return { type: 'stat', height: 'auto' };       // 12% stats
    else if (rand < 0.84) return { type: 'warning', height: 'auto' };    // 10% warnings
    else if (rand < 0.92) return { type: 'fact', height: 'auto' };       // 8% facts
    else if (rand < 0.97) return { type: 'recipe', height: 'auto' };     // 5% recipes
    else return { type: 'review', height: 'auto' };                      // 3% reviews (with stars)
  }

  async function load() {
    if (all.length === 0) {
      try {
        const res = await fetch(FEED_URL);
        all = await res.json();
      } catch (err) {
        console.error('Failed to load feed', err);
        return;
      }
    }
    
    const container = document.getElementById('bf-feed');
    const slice = all.slice(idx, idx + batch);
    idx += slice.length;
    
    for (let i = 0; i < slice.length; i++) {
      const item = slice[i];
      const tag = item.url ? 'a' : 'article';
      const card = document.createElement(tag);
      
      // Generate chaotic content
      const content = generateChaosContent(item);
      const cardType = generateCardType();
      
      // Clean, consistent styling
      card.className = `group block break-inside-avoid mb-4 p-4 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all duration-200 ${cardType.height}`;
      
      if (item.url) card.setAttribute('href', item.url);
      
      // Generate different card layouts based on type
      let cardHTML = '';
      
      switch(cardType.type) {
        case 'quote':
          cardHTML = `
            <blockquote class="border-l-4 border-brand-pink pl-4">
              <p class="text-lg italic mb-2">"${content.title}"</p>
              <cite class="text-sm opacity-60">- ${getRandomElement(['Ancient Wisdom', 'Internet Sage', 'My Uncle', 'Source: Trust Me', 'Anonymous Fruit'])}</cite>
            </blockquote>
            ${content.extra}
            ${item.url ? '<div class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition mt-3">EXPLORE â†’</div>' : ''}
          `;
          break;
          
        case 'stat':
          const percentage = Math.floor(Math.random() * 100);
          cardHTML = `
            <div class="text-center">
              <div class="text-4xl font-black text-brand-yellow mb-2">${percentage}%</div>
              <p class="text-sm">${content.title}</p>
              <div class="text-xs mt-2 opacity-60">Sample size: ${Math.floor(Math.random() * 10) + 1} ${getRandomElement(['people', 'fruits', 'beefs', 'vibes', 'thoughts'])}</div>
              ${item.url ? '<div class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition mt-3">SEE DATA â†’</div>' : ''}
            </div>
          `;
          break;
          
        case 'warning':
          cardHTML = `
            <div class="bg-red-900/20 border border-red-500/30 rounded p-3">
              <div class="text-red-400 font-bold mb-1">âš ï¸ ALERT âš ï¸</div>
              <p class="text-sm">${content.title}</p>
              ${content.extra}
              ${item.url ? '<div class="text-red-400 text-sm opacity-0 group-hover:opacity-100 transition mt-2">LEARN MORE â†’</div>' : ''}
            </div>
          `;
          break;
          
        case 'recipe':
          cardHTML = `
            <div>
              <div class="text-xs text-brand-green mb-1">RECIPE</div>
              <h3 class="font-bold mb-2">${content.title}</h3>
              <div class="text-sm opacity-80">
                <div>Ingredients: ${getRandomElement(['Chaos', 'Hope', 'Beef', 'Fruit', 'Vibes', 'Energy'])} + ${getRandomElement(['Dreams', 'Nightmares', 'Salt', 'Pepper', 'Love', 'Rage'])}</div>
                <div class="mt-1">Instructions: ${getRandomElement(['Mix until confused', 'Shake vigorously', 'Contemplate existence', 'Add heat', 'Serve immediately', 'Abandon all hope'])}</div>
              </div>
              ${item.url ? '<div class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition mt-3">GET RECIPE â†’</div>' : ''}
            </div>
          `;
          break;
          
        case 'review':
          const stars = Math.floor(Math.random() * 5) + 1;
          cardHTML = `
            <div>
              <div class="text-brand-yellow mb-1">${'â­'.repeat(stars)}${'â˜†'.repeat(5-stars)}</div>
              <h3 class="font-bold mb-1">${content.title}</h3>
              <p class="text-sm opacity-80 mb-2">${item.blurb}</p>
              ${content.extra}
              ${item.url ? '<div class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition mt-2">READ REVIEW â†’</div>' : ''}
            </div>
          `;
          break;
          
        case 'fact':
          cardHTML = `
            <div class="bg-gradient-to-br from-brand-blue/20 to-brand-green/20 rounded p-3">
              <div class="text-xs font-bold text-brand-green mb-1">ğŸ§  FUN FACT</div>
              <p class="text-sm">${content.title}</p>
              <div class="text-xs mt-2 opacity-60">Source: ${getRandomElement(['Wikipedia', 'My dreams', 'Ancient scrolls', 'The void', 'Trust me bro'])}</div>
              ${item.url ? '<div class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition mt-2">VERIFY â†’</div>' : ''}
            </div>
          `;
          break;
          
        default:
          // Only show emoji sometimes, and vary the layout
          const showEmoji = Math.random() > 0.7; // Reduce emoji frequency even more
          const showBlurb = Math.random() > 0.2;
          
          // Replace sparkles emoji with random varied emojis or skip it
          const displayEmoji = (item.emoji === 'âœ¨') ? 
            (Math.random() > 0.5 ? '' : getRandomElement(['ğŸ¤¯', 'ğŸ–', 'ğŸ‰', 'ğŸ”¥', 'ğŸ’¥', 'ğŸŒˆ', 'ğŸ¦¾', 'ğŸŒ®', 'ğŸ•', 'ğŸ”', 'ğŸ†', 'ğŸƒ', 'ğŸ‘¾', 'ğŸ¤–'])) : 
            item.emoji;
          
          cardHTML = `
            <div>
              <h3 class="font-bold text-lg mb-2">${content.title}</h3>
              ${showBlurb ? `<p class="text-sm text-gray-300 mb-3">${item.blurb}</p>` : ''}
              ${content.extra}
              ${(showEmoji && displayEmoji) || item.url ? `
                <div class="flex items-center justify-between mt-3">
                  ${(showEmoji && displayEmoji) ? `<span class="text-2xl">${displayEmoji}</span>` : '<span></span>'}
                  ${item.url ? '<span class="text-brand-yellow text-sm opacity-0 group-hover:opacity-100 transition">READ â†’</span>' : ''}
                </div>
              ` : ''}
            </div>
          `;
      }
      
      // Add random badges
      if (Math.random() > 0.8) {
        const badges = [
          '<span class="absolute -top-2 -right-2 bg-brand-pink text-white text-xs px-2 py-1 rounded-full font-bold">NEW</span>',
          '<span class="absolute -top-2 -right-2 bg-brand-yellow text-black text-xs px-2 py-1 rounded-full font-bold">HOT</span>',
          '<span class="absolute -top-2 -right-2 bg-red-600 text-white text-xs px-2 py-1 rounded-full font-bold animate-pulse">LIVE</span>',
          '<span class="absolute -top-2 -right-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xs px-2 py-1 rounded-full font-bold">VIRAL</span>'
        ];
        cardHTML = `<div class="relative">${cardHTML}${getRandomElement(badges)}</div>`;
      }
      
      card.innerHTML = cardHTML;
      container.appendChild(card);
    }
  }

  document.getElementById('bf-more')?.addEventListener('click', load);
  load();
</script>

